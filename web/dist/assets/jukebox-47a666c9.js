import{r as t,l as A,cY as G,cZ as a,cW as T,k as y}from"./index-d2f5e843.js";const v="/assets/prelude-3f0462a2.ogg",O="/assets/prelude-4bf55512.mp3",V="/assets/getting_off_the_ground-2afe794a.ogg",F="/assets/getting_off_the_ground-eee5cd8e.mp3",J="/assets/drifting_into_space-2507ef6c.ogg",P="/assets/drifting_into_space-ccf6953e.mp3",R="/assets/looking_ahead-865c08b7.ogg",j="/assets/looking_ahead-b5d48fb9.mp3",z="/assets/measuring_the_challenge-97680074.ogg",D="/assets/measuring_the_challenge-3ea6dd69.mp3",N="/assets/putting_it_all_together-46f95a5a.ogg",U="/assets/putting_it_all_together-bb8703a4.mp3",q="/assets/not_the_end-2042ea10.ogg",L="/assets/not_the_end-5efc7b0e.mp3",Y="/assets/hub_ambience-b83d71e7.ogg",$="/assets/hub_ambience-c7224ffe.mp3",K=.5,W=4,X=t.createContext({requestSong:()=>{throw new Error("JukeboxContext not initialized")},stopSong:()=>{throw new Error("JukeboxContext not initialized")},stopAllMusic:()=>{throw new Error("JukeboxContext not initialized")},duckMusic:()=>{throw new Error("JukeboxContext not initialized")},unduckMusic:()=>{throw new Error("JukeboxContext not initialized")}});function H(S){const[o]=A(),[g,x]=t.useState(o.settings.masterVolume),[f,d]=t.useState(o.settings.musicVolume),[m,h]=t.useState(1),u=t.useRef(null);t.useEffect(()=>{x(o.settings.masterVolume),d(o.settings.musicVolume)},[o.settings.masterVolume,o.settings.musicVolume]);const p=t.useMemo(()=>G(g*f*m),[g,f,m]);t.useEffect(()=>{d(o.settings.musicVolume)},[o.settings.musicVolume]);const[Z,C]=t.useState([]),s=t.useMemo(()=>({prelude:new a("prelude","music",[v,O],{loop:!0,fadeIn:4e3,preload:!1}),gettingOffTheGround:new a("gettingOffTheGround","music",[V,F],{loop:!0,fadeIn:10,preload:!1,stream:!0}),driftingIntoSpace:new a("driftingIntoSpace","music",[J,P],{loop:!0,fadeIn:10,preload:!1}),lookingAhead:new a("lookingAhead","music",[R,j],{loop:!0,fadeIn:10,preload:!1,stream:!0}),measuringTheChallenge:new a("measuringTheChallenge","music",[z,D],{loop:!0,fadeIn:10,preload:!1,stream:!0}),puttingItAllTogether:new a("puttingItAllTogether","music",[N,U],{loop:!0,fadeIn:10,preload:!1,stream:!0}),notTheEnd:new a("notTheEnd","music",[q,L],{loop:!0,fadeIn:10,preload:!1,stream:!0}),hubAmbience:new a("hubAmbience","music",[Y,$],{baseGain:3,loop:!0,fadeIn:1e3,preload:!1,stream:!1})}),[]),b=t.useCallback(e=>{C(n=>{let l=[...n];if(l.push(e),l=l.reverse().filter((r,I)=>l.indexOf(r)===I).reverse(),l.length>W){const r=l.shift();r&&s[r].unload()}return l})},[s]),c=t.useCallback(()=>{for(const[e,n]of Object.entries(s))if(n.isPlaying())return e;return null},[s]);t.useEffect(()=>{Object.values(s).filter(e=>e.category==="music").forEach(e=>{e.setCatGain(p)})},[p,s]);const i=t.useCallback(e=>{Object.values(s).filter(n=>n.category==="music").forEach(n=>{n.isPlaying()&&n.stop(e)})},[s]),_=t.useCallback(e=>{if(s[e]==null)throw new Error(`No song with id ${e}`);if(c()===e)return;const n=s[e];c()!==null?(i(T),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{n.play()},T)):n.play(),b(e)},[c,s,b,i]),k=t.useCallback(e=>{if(e in s)s[e].stop();else throw new Error(`No song with id ${e}`)},[s]),w=t.useCallback(()=>{h(K)},[]),E=t.useCallback(()=>{h(1)},[]),M=t.useMemo(()=>({requestSong:_,stopSong:k,stopAllMusic:i,duckMusic:w,unduckMusic:E}),[_,k,w,i,E]);return y.jsx(X.Provider,{value:M,children:S.children})}export{X as JukeboxContext,H as JukeboxProvider};
